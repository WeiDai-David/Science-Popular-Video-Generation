<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动态解说：学习率调度 (Learning Rate Scheduling)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500&family=Poppins:wght@300;400;500&display=swap');

        :root {
            --bg-color: #F8F9FA;
            --primary-text: #343A40;
            --secondary-text: #6C757D;
            --accent-blue: #4A90E2;
            --accent-green: #50E3C2;
            --accent-red: #D0021B;
            --accent-orange: #F5A623;
            --line-color: #DEE2E6;
            --surface-color: #FFFFFF;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color);
            font-family: 'Poppins', 'Noto Sans SC', sans-serif;
            overflow: hidden;
        }

        #animation-viewport {
            width: 100vw;
            height: 56.25vw;
            /* 16:9 Aspect Ratio */
            max-height: 100vh;
            max-width: 177.78vh;
            /* 16:9 Aspect Ratio */
            position: relative;
        }

        #animation-container {
            width: 2560px;
            height: 1440px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: center center;
            overflow: hidden;
            background-color: var(--bg-color);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.08);
            border-radius: 20px;
        }

        .scene {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            pointer-events: none;
        }

        .scene.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Subtitles */
        #subtitles {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            text-align: center;
            z-index: 100;
        }

        .subtitle-line {
            font-size: 48px;
            font-weight: 500;
            color: var(--primary-text);
            text-shadow: 0px 2px 10px rgba(255, 255, 255, 0.7);
            line-height: 1.5;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .subtitle-line.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .subtitle-line .en {
            font-size: 32px;
            font-weight: 400;
            color: var(--secondary-text);
            margin-top: 8px;
            display: block;
        }

        /* Background Elements */
        .bg-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }

        .bg-shapes div {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, rgba(74, 144, 226, 0.1), rgba(80, 227, 194, 0.1));
            animation: float 20s infinite ease-in-out alternate;
        }

        .bg-shapes .shape1 {
            width: 400px;
            height: 400px;
            top: 10%;
            left: 5%;
            animation-duration: 25s;
        }

        .bg-shapes .shape2 {
            width: 250px;
            height: 250px;
            top: 60%;
            right: 10%;
            animation-duration: 18s;
        }

        .bg-shapes .shape3 {
            width: 150px;
            height: 150px;
            top: 20%;
            right: 20%;
            animation-duration: 22s;
        }

        @keyframes float {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
            }

            100% {
                transform: translateY(40px) translateX(20px) rotate(20deg);
            }
        }

        /* Title Scene */
        #title-scene .title-text {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        #title-scene h1 {
            font-size: 120px;
            color: var(--primary-text);
            margin: 0;
            font-weight: 500;
            letter-spacing: 2px;
        }

        #title-scene h2 {
            font-size: 60px;
            color: var(--secondary-text);
            margin: 0;
            font-weight: 300;
        }

        /* Loss Landscape Scene */
        .loss-landscape-container {
            position: absolute;
            width: 1800px;
            height: 1000px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #loss-svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .loss-path {
            fill: none;
            stroke: var(--line-color);
            stroke-width: 8;
            stroke-linecap: round;
        }

        .loss-fill {
            fill: url(#lossGradient);
            opacity: 0.6;
        }

        .optimum-point {
            fill: var(--accent-green);
            filter: drop-shadow(0 0 15px rgba(80, 227, 194, 0.8));
        }

        .optimum-label {
            font-size: 36px;
            font-family: 'Poppins', 'Noto Sans SC', sans-serif;
            fill: var(--accent-green);
            text-anchor: middle;
            font-weight: 500;
        }

        .model-ball {
            transition: transform 0.1s linear;
            position: absolute;
        }

        .ball-trail {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .trail-dot {
            position: absolute;
            border-radius: 50%;
            opacity: 0;
            animation: fade-in 0.5s forwards;
        }

        @keyframes fade-in {
            to {
                opacity: 0.7;
            }
        }

        .lr-label {
            position: absolute;
            top: 150px;
            left: 50%;
            transform: translateX(-50%);
            padding: 20px 40px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 2px solid var(--line-color);
            border-radius: 20px;
            font-size: 48px;
            font-weight: 500;
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .lr-label.visible {
            opacity: 1;
        }

        /* Scheduler Graph Scene */
        #scheduler-graph-container {
            position: absolute;
            width: 1200px;
            height: 800px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--surface-color);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            opacity: 0;
        }

        .graph-title {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 52px;
            color: var(--primary-text);
            font-weight: 500;
        }

        #scheduler-svg {
            position: absolute;
            top: 150px;
            left: 100px;
            width: 1000px;
            height: 600px;
        }

        .axis {
            stroke: var(--secondary-text);
            stroke-width: 4;
        }

        .axis-label {
            font-size: 32px;
            fill: var(--secondary-text);
            font-family: 'Poppins', 'Noto Sans SC', sans-serif;
        }

        .lr-path {
            fill: none;
            stroke: var(--accent-blue);
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 2000;
            stroke-dashoffset: 2000;
        }

        /* Final Scene */
        #final-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 80px;
            color: var(--primary-text);
            font-weight: 500;
            opacity: 0;
        }
    </style>
</head>

<body>

    <div id="animation-viewport">
        <div id="animation-container">
            <!-- BACKGROUND -->
            <div class="bg-shapes">
                <div class="shape1"></div>
                <div class="shape2"></div>
                <div class="shape3"></div>
            </div>

            <!-- SCENES -->
            <div id="title-scene" class="scene">
                <div class="title-text">
                    <h1>学习率调度</h1>
                    <h2>Learning Rate Scheduling</h2>
                </div>
            </div>

            <div id="landscape-scene" class="scene">
                <div class="lr-label"></div>
                <div class="loss-landscape-container">
                    <div class="ball-trail"></div>
                    <svg id="loss-svg" viewBox="0 0 1800 1000">
                        <defs>
                            <linearGradient id="lossGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:rgba(74, 144, 226, 0.05)" />
                                <stop offset="100%" style="stop-color:rgba(74, 144, 226, 0.2)" />
                            </linearGradient>
                        </defs>
                        <path id="loss-fill-path" class="loss-fill"
                            d="M0 400 C 200 150, 400 150, 600 400 S 800 800, 1050 750 C 1250 700, 1350 450, 1500 500 S 1700 650, 1800 600 L 1800 1000 L 0 1000 Z">
                        </path>
                        <path id="loss-path" class="loss-path"
                            d="M0 400 C 200 150, 400 150, 600 400 S 800 800, 1050 750 C 1250 700, 1350 450, 1500 500 S 1700 650, 1800 600">
                        </path>
                        <circle id="optimum" class="optimum-point" cx="400" cy="188" r="20"></circle>
                        <text class="optimum-label" x="400" y="150">最优解 / Optimum</text>
                    </svg>
                    <div id="model-ball" class="model-ball">
                        <svg width="60" height="60" viewBox="0 0 60 60">
                            <circle cx="30" cy="30" r="25" fill="url(#ballGradient)" stroke="#fff" stroke-width="4"
                                filter="url(#ballShadow)" />
                            <defs>
                                <radialGradient id="ballGradient" cx="0.3" cy="0.3" r="0.7">
                                    <stop offset="0%" stop-color="#fff" />
                                    <stop offset="100%" stop-color="var(--accent-blue)" />
                                </radialGradient>
                                <filter id="ballShadow">
                                    <feDropShadow dx="0" dy="5" stdDeviation="5" flood-color="rgba(0,0,0,0.2)" />
                                </filter>
                            </defs>
                        </svg>
                    </div>
                </div>
            </div>

            <div id="scheduler-scene" class="scene">
                <div id="scheduler-graph-container">
                    <div class="graph-title">学习率调度策略 (Learning Rate Schedule)</div>
                    <svg id="scheduler-svg" viewBox="0 0 1000 600">
                        <!-- Axes -->
                        <line class="axis" x1="50" y1="550" x2="950" y2="550"></line> <!-- X axis -->
                        <line class="axis" x1="50" y1="550" x2="50" y2="50"></line> <!-- Y axis -->
                        <!-- Axis Labels -->
                        <text class="axis-label" x="970" y="555">训练步数 (Steps)</text>
                        <text class="axis-label" x="40" y="40" text-anchor="end" transform="rotate(-90, 40, 40)">学习率
                            (LR)</text>
                        <!-- LR Path -->
                        <path id="lr-path" class="lr-path" d="M 60 100 Q 300 120, 500 300 T 900 520"></path>
                    </svg>
                </div>
            </div>

            <div id="final-scene" class="scene">
                <div id="final-text">
                    <p>合理调度学习率</p>
                    <p style="font-size: 52px; color: var(--secondary-text); margin-top: 20px;">更快收敛，更好结果</p>
                    <p style="font-size: 52px; color: var(--secondary-text); margin-top: 40px;">Faster Convergence,
                        Better Results</p>
                </div>
            </div>

            <!-- SUBTITLES CONTAINER -->
            <div id="subtitles">
                <p class="subtitle-line">
                    <span class="cn"></span>
                    <span class="en"></span>
                </p>
            </div>
        </div>
    </div>

    <script>
        const subs = [
            { cn: "在训练神经网络时，一个关键的超参数是“学习率”。", en: "When training a neural network, a key hyperparameter is the 'learning rate'.", duration: 4000 },
            { cn: "它决定了模型在每次迭代中更新权重的幅度。", en: "It determines the step size at which the model updates its weights.", duration: 4000 },
            { cn: "我们的目标，是找到损失函数的最低点，即最优解。", en: "Our goal is to find the lowest point of the loss function, the optimum solution.", duration: 4000 },
            { cn: "如果学习率设置得太高...", en: "If the learning rate is set too high...", duration: 2000 },
            { cn: "模型可能会在最优解附近剧烈震荡，难以收敛。", en: "The model might oscillate wildly around the optimum, struggling to converge.", duration: 5000 },
            { cn: "甚至可能导致损失发散，训练失败。", en: "It could even cause the loss to diverge, failing the training.", duration: 4000 },
            { cn: "反之，如果学习率设置得太低...", en: "Conversely, if the learning rate is set too low...", duration: 2000 },
            { cn: "模型会更新得非常缓慢，需要极长的训练时间。", en: "The model will update very slowly, requiring a huge amount of training time.", duration: 5000 },
            { cn: "并且，它还容易陷入不理想的局部最小值。", en: "Moreover, it can easily get stuck in a suboptimal local minimum.", duration: 4000 },
            { cn: "那么，有没有更好的方法呢？", en: "So, is there a better way?", duration: 2500 },
            { cn: "答案是：学习率调度。", en: "The answer is: Learning Rate Scheduling.", duration: 3000 },
            { cn: "我们让学习率随着训练的进行而动态变化。", en: "We let the learning rate change dynamically as the training progresses.", duration: 4000 },
            { cn: "通常，在训练初期使用一个较大的学习率...", en: "Typically, we start with a relatively high learning rate in the beginning...", duration: 4000 },
            { cn: "让模型能快速接近最优区域。", en: "Allowing the model to quickly approach the optimal region.", duration: 4000 },
            { cn: "随着训练深入，我们逐渐降低学习率...", en: "As the training goes on, we gradually decrease the learning rate...", duration: 4000 },
            { cn: "这使得模型可以在最优解附近进行精细调整，稳定收敛。", en: "This allows the model to fine-tune near the optimum and converge stably.", duration: 5000 },
            { cn: "这种策略，结合了高低学习率的优点。", en: "This strategy combines the advantages of both high and low learning rates.", duration: 4000 },
            { cn: "最终，帮助我们更快地找到更好的模型。", en: "Ultimately, it helps us find a better model, faster.", duration: 4000 },
        ];

        // DOM Elements
        const container = document.getElementById('animation-container');
        const subtitlesContainer = document.querySelector('#subtitles .subtitle-line');
        const cnSub = subtitlesContainer.querySelector('.cn');
        const enSub = subtitlesContainer.querySelector('.en');
        const scenes = document.querySelectorAll('.scene');

        const lossPath = document.getElementById('loss-path');
        const pathLength = lossPath.getTotalLength();
        const modelBall = document.getElementById('model-ball');
        const ballTrailContainer = document.querySelector('.ball-trail');
        const lrLabel = document.querySelector('.lr-label');

        // Animation state
        let currentSub = 0;
        let animationFrameId;

        function resizeContainer() {
            const viewport = document.getElementById('animation-viewport');
            const scale = Math.min(
                viewport.clientWidth / 2560,
                viewport.clientHeight / 1440
            );
            container.style.transform = `translate(-50%, -50%) scale(${scale})`;
        }

        window.addEventListener('resize', resizeContainer);


        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function updateSubtitles() {
            if (currentSub >= subs.length) {
                subtitlesContainer.classList.remove('visible');
                return;
            };

            const sub = subs[currentSub];
            cnSub.textContent = sub.cn;
            enSub.textContent = sub.en;
            subtitlesContainer.classList.add('visible');

            await sleep(sub.duration);
            subtitlesContainer.classList.remove('visible');
            await sleep(500); // Pause between subs
            currentSub++;
        }

        function switchScene(sceneId) {
            scenes.forEach(scene => {
                if (scene.id === sceneId) {
                    scene.classList.add('active');
                } else {
                    scene.classList.remove('active');
                }
            });
        }

        function getPointOnPath(fraction) {
            return lossPath.getPointAtLength(fraction * pathLength);
        }

        function updateBallPosition(fraction) {
            const point = getPointOnPath(fraction);
            modelBall.style.transform = `translate(${point.x - 30}px, ${point.y - 30}px)`;
        }

        function addTrailDot(fraction, color, size) {
            const point = getPointOnPath(fraction);
            const dot = document.createElement('div');
            dot.className = 'trail-dot';
            dot.style.width = `${size}px`;
            dot.style.height = `${size}px`;
            dot.style.backgroundColor = color;
            dot.style.left = `${point.x - size / 2}px`;
            dot.style.top = `${point.y - size / 2}px`;
            ballTrailContainer.appendChild(dot);
        }

        function clearTrail() {
            ballTrailContainer.innerHTML = '';
        }

        function animateBall({ start, end, duration, easing, onUpdate, onComplete }) {
            let startTime = null;

            function frame(currentTime) {
                if (!startTime) startTime = currentTime;
                const elapsedTime = currentTime - startTime;
                let progress = Math.min(elapsedTime / duration, 1);

                const easedProgress = easing(progress);
                const currentPos = start + (end - start) * easedProgress;

                updateBallPosition(currentPos);
                if (onUpdate) onUpdate(currentPos, progress);

                if (progress < 1) {
                    animationFrameId = requestAnimationFrame(frame);
                } else {
                    if (onComplete) onComplete();
                }
            }
            animationFrameId = requestAnimationFrame(frame);
        }

        // --- Main Animation Timeline ---

        async function playIntro() {
            switchScene('title-scene');
            const title = document.querySelector('#title-scene .title-text');
            title.style.transition = 'opacity 1s ease-in, transform 1s ease-in';
            title.style.opacity = 1;
            title.style.transform = 'translate(-50%, -50%) scale(1)';
            await sleep(2000);
            await updateSubtitles(); // sub 0
            await updateSubtitles(); // sub 1
            await updateSubtitles(); // sub 2
        }

        async function playHighLR() {
            switchScene('landscape-scene');
            clearTrail();
            updateBallPosition(0.05);
            lrLabel.textContent = "学习率过高 / High Learning Rate";
            lrLabel.style.color = 'var(--accent-red)';
            lrLabel.classList.add('visible');

            await updateSubtitles(); // sub 3

            let progress = 0.05;
            let velocity = 0.04;
            const target = 0.222; // optimum point
            const gravity = 0.001;

            return new Promise(resolve => {
                let steps = 0;
                const intervalId = setInterval(() => {
                    const distance = target - progress;
                    velocity += distance * gravity;
                    velocity *= 0.95; // damping
                    progress += velocity;
                    updateBallPosition(progress);
                    if (steps % 3 === 0) addTrailDot(progress, 'rgba(208, 2, 27, 0.5)', 20);

                    steps++;
                    if (steps > 150) {
                        clearInterval(intervalId);
                        resolve();
                    }
                }, 30);
            });
        }

        async function playLowLR() {
            clearTrail();
            updateBallPosition(0.05);
            lrLabel.textContent = "学习率过低 / Low Learning Rate";
            lrLabel.style.color = 'var(--accent-orange)';

            await updateSubtitles(); // sub 6

            return new Promise(resolve => {
                animateBall({
                    start: 0.05,
                    end: 0.55, // gets stuck in local minimum
                    duration: 8000,
                    easing: t => t,
                    onUpdate: (pos, prog) => {
                        if (Math.floor(prog * 100) % 5 === 0) {
                            addTrailDot(pos, 'rgba(245, 166, 35, 0.5)', 15);
                        }
                    },
                    onComplete: resolve
                });
            });
        }

        async function playSchedulerIntro() {
            lrLabel.classList.remove('visible');
            switchScene('scheduler-scene');
            await sleep(500);

            const graph = document.getElementById('scheduler-graph-container');
            graph.style.transition = 'opacity 1s, transform 1s';
            graph.style.opacity = 1;
            graph.style.transform = 'translate(-50%, -50%) scale(1)';

            await updateSubtitles(); // sub 9
            await updateSubtitles(); // sub 10
            await updateSubtitles(); // sub 11

            const lrPath = document.getElementById('lr-path');
            lrPath.style.transition = 'stroke-dashoffset 3s ease-out';
            lrPath.style.strokeDashoffset = '0';

            await sleep(500);
            await updateSubtitles(); // sub 12
            await sleep(3000);

            graph.style.opacity = 0;
            graph.style.transform = 'translate(-50%, -50%) scale(0.9)';
            await sleep(1000);
        }

        async function playGoodLR() {
            switchScene('landscape-scene');
            clearTrail();
            updateBallPosition(0.05);
            lrLabel.textContent = "学习率调度 / LR Scheduling";
            lrLabel.style.color = 'var(--accent-blue)';
            lrLabel.classList.add('visible');

            await updateSubtitles(); // sub 13

            // First big jump
            await new Promise(resolve => animateBall({
                start: 0.05, end: 0.2, duration: 2000, easing: t => t,
                onUpdate: (pos, prog) => { if (Math.floor(prog * 100) % 10 === 0) addTrailDot(pos, 'rgba(74, 144, 226, 0.6)', 25); },
                onComplete: resolve
            }));

            await updateSubtitles(); // sub 14

            // Second smaller jump
            await new Promise(resolve => animateBall({
                start: 0.2, end: 0.23, duration: 1500, easing: t => t,
                onUpdate: (pos, prog) => { if (Math.floor(prog * 100) % 15 === 0) addTrailDot(pos, 'rgba(80, 227, 194, 0.6)', 20); },
                onComplete: resolve
            }));

            await updateSubtitles(); // sub 15

            // Final convergence
            await new Promise(resolve => animateBall({
                start: 0.23, end: 0.222, duration: 2000, easing: t => t,
                onUpdate: (pos, prog) => { if (Math.floor(prog * 100) % 20 === 0) addTrailDot(pos, 'rgba(80, 227, 194, 0.8)', 15); },
                onComplete: resolve
            }));
        }

        async function playOutro() {
            lrLabel.classList.remove('visible');
            await sleep(500);
            await updateSubtitles(); // sub 16
            await updateSubtitles(); // sub 17

            switchScene('final-scene');
            const finalText = document.getElementById('final-text');
            finalText.style.transition = 'opacity 1s';
            finalText.style.opacity = 1;
        }

        async function main() {
            resizeContainer();

            // Start sequence
            await playIntro();

            // Problem 1: High LR
            switchScene('landscape-scene');
            await sleep(1000);
            await playHighLR();
            await updateSubtitles(); // sub 4
            await updateSubtitles(); // sub 5
            lrLabel.classList.remove('visible');
            await sleep(1000);

            // Problem 2: Low LR
            await playLowLR();
            await updateSubtitles(); // sub 7
            await updateSubtitles(); // sub 8
            lrLabel.classList.remove('visible');
            await sleep(1000);

            // Solution: LR Scheduling
            await playSchedulerIntro();

            // Demo: Good LR
            await playGoodLR();

            // Outro
            await playOutro();

        }

        // Start the animation on load
        window.onload = main;

    </script>
</body>

</html>