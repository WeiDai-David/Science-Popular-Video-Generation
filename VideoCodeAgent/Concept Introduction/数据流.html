<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Journey of Data: A Data Flow Animation</title>
    <style>
        :root {
            --bg-color: #F8F9FA;
            --primary-color: #4A90E2;
            --secondary-color: #50E3C2;
            --accent-color: #F5A623;
            --text-color: #333;
            --light-text-color: #f0f0f0;
            --container-bg: #FFFFFF;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            overflow: hidden;
        }

        #animation-container {
            position: relative;
            width: 100vw;
            height: 56.25vw;
            /* 16:9 Aspect Ratio */
            max-width: 2560px;
            max-height: 1440px;
            background-color: var(--container-bg);
            box-shadow: 0 10px 30px var(--shadow-color);
            border-radius: 12px;
            overflow: hidden;
        }

        .scene {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        /* --- Title Scene --- */
        #title-scene {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #title-scene h1 {
            font-size: 5vw;
            /* Responsive font size */
            color: var(--primary-color);
            margin: 0;
            font-weight: 300;
            letter-spacing: 2px;
        }

        #title-scene h2 {
            font-size: 2.5vw;
            color: var(--text-color);
            margin-top: 1%;
            font-weight: 400;
        }

        /* --- Main Flow Scene Elements --- */
        .flow-element {
            position: absolute;
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }

        .flow-element.visible {
            opacity: 1;
            transform: scale(1);
        }

        .element-label {
            position: absolute;
            bottom: -15%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2vw;
            color: var(--text-color);
            font-weight: 500;
            white-space: nowrap;
        }

        /* --- Source Elements --- */
        #source-group {
            top: 42%;
            left: 10%;
            width: 20%;
            height: 30%;
        }

        #source-group .icon-container {
            position: absolute;
        }

        #source-user {
            top: 0;
            left: 25%;
            width: 50%;
        }

        #source-mobile {
            top: 50%;
            left: 0;
            width: 35%;
        }

        #source-db {
            top: 50%;
            left: 65%;
            width: 35%;
        }

        /* --- Processing Element --- */
        #processing-group {
            top: 35%;
            left: 45%;
            width: 10%;
            height: 20%;
        }

        #processing-gears {
            width: 100%;
        }

        .gear {
            animation: rotate 10s linear infinite;
        }

        .gear.reverse {
            animation: rotate-reverse 10s linear infinite;
        }

        @keyframes rotate {
            from {
                transform-origin: center;
                transform: rotate(0deg);
            }

            to {
                transform-origin: center;
                transform: rotate(360deg);
            }
        }

        @keyframes rotate-reverse {
            from {
                transform-origin: center;
                transform: rotate(0deg);
            }

            to {
                transform-origin: center;
                transform: rotate(-360deg);
            }
        }

        /* --- Destination Elements --- */
        #destination-group {
            top: 42%;
            left: 75%;
            width: 20%;
            height: 30%;
        }

        #destination-group .icon-container {
            position: absolute;
        }

        #destination-dashboard {
            top: 0;
            left: 25%;
            width: 50%;
        }

        #destination-warehouse {
            top: 60%;
            left: 0;
            width: 45%;
        }

        #destination-app {
            top: 60%;
            left: 55%;
            width: 45%;
        }

        /* --- Icons SVG Styling --- */
        .icon-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0.3vw 0.5vw rgba(74, 144, 226, 0.2));
        }

        .icon-fill {
            fill: var(--primary-color);
        }

        .icon-stroke {
            stroke: var(--primary-color);
            stroke-width: 8;
            fill: none;
        }

        .icon-accent-fill {
            fill: var(--secondary-color);
        }

        .icon-bg-fill {
            fill: #EAF2FB;
        }

        /* --- Data Flow Path and Particles --- */
        #flow-path-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        #flow-path {
            stroke: #D8E6F8;
            stroke-width: 0.4vw;
            fill: none;
            stroke-dasharray: 2vw 1vw;
            animation: dash 60s linear infinite;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: 1000;
            }
        }

        .data-particle {
            position: absolute;
            width: 1vw;
            height: 1vw;
            border-radius: 50%;
            background-color: var(--accent-color);
            z-index: 2;
            opacity: 0;
            box-shadow: 0 0 0.8vw var(--accent-color);
        }

        /* --- Subtitle --- */
        #subtitle-container {
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            text-align: center;
            z-index: 100;
        }

        .subtitle-line {
            display: block;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .subtitle-line.visible {
            opacity: 1;
            transform: translateY(0);
        }

        #subtitle-en {
            font-size: 1.6vw;
            color: var(--text-color);
            font-weight: 500;
        }

        #subtitle-cn {
            font-size: 1.3vw;
            color: #555;
            margin-top: 0.5%;
        }

        /* --- Summary overlay --- */
        #summary-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0);
            transition: background 1s ease-in-out;
            z-index: 3;
            pointer-events: none;
        }

        .summary-label {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            padding: 0.8vw 1.5vw;
            border-radius: 2vw;
            font-size: 1.5vw;
            font-weight: 600;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            opacity: 0;
            transform: scale(0.7);
            transition: opacity 0.8s, transform 0.8s;
            transition-timing-function: cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #summary-source {
            top: 35%;
            left: 15%;
        }

        #summary-process {
            top: 28%;
            left: 45%;
        }

        #summary-destination {
            top: 35%;
            left: 72%;
        }
    </style>
</head>

<body>

    <div id="animation-container">
        <!-- Title Scene -->
        <div id="title-scene" class="scene">
            <h1>Data Flow</h1>
            <h2>数据流的旅程</h2>
        </div>

        <!-- Main Flow Scene -->
        <div id="main-scene" class="scene">
            <!-- Source Group -->
            <div id="source-group" class="flow-element">
                <div id="source-user" class="icon-container">
                    <svg class="icon-svg" viewBox="0 0 100 100">
                        <rect class="icon-bg-fill" x="5" y="65" width="90" height="10" rx="5"></rect>
                        <path class="icon-bg-fill" d="M0 20C0 10 10 0 20 0H80C90 0 100 10 100 20V65H0V20Z"></path>
                        <rect class="icon-accent-fill" x="20" y="20" width="60" height="35" rx="3"></rect>
                        <circle class="icon-fill" cx="50" y="85" r="5"></circle>
                    </svg>
                </div>
                <div id="source-mobile" class="icon-container">
                    <svg class="icon-svg" viewBox="0 0 100 100">
                        <rect class="icon-bg-fill" x="15" y="5" width="70" height="90" rx="15"></rect>
                        <rect class="icon-accent-fill" x="25" y="15" width="50" height="70" rx="5"></rect>
                        <line class="icon-fill" x1="40" y1="90" x2="60" y2="90" stroke-width="5" stroke-linecap="round">
                        </line>
                    </svg>
                </div>
                <div id="source-db" class="icon-container">
                    <svg class="icon-svg" viewBox="0 0 100 100">
                        <ellipse class="icon-fill" cx="50" cy="20" rx="40" ry="15"></ellipse>
                        <path class="icon-fill"
                            d="M10 20V80C10 91.0457 27.9086 100 50 100C72.0914 100 90 91.0457 90 80V20"></path>
                        <ellipse class="icon-bg-fill" cx="50" cy="20" rx="35" ry="12"></ellipse>
                    </svg>
                </div>
                <div class="element-label">Data Sources / 数据源</div>
            </div>

            <!-- Processing Group -->
            <div id="processing-group" class="flow-element">
                <svg id="processing-gears" class="icon-svg" viewBox="0 0 100 100">
                    <path class="icon-fill gear"
                        d="M65.5,50.8l-4.5-2.6l-0.1-0.1c-0.1-0.2-0.2-0.3-0.2-0.5v-5.2c0.1-0.2,0.2-0.3,0.2-0.5l0.1-0.1l4.5-2.6 c0.4-0.2,0.6-0.7,0.4-1.1l-2.6-4.5c-0.2-0.4-0.7-0.6-1.1-0.4l-4.5,2.6c-0.2,0.1-0.3,0.2-0.5,0.2h-0.1l-2.6-4.5 c-0.2-0.4-0.7-0.6-1.1-0.4l-4.5,2.6c-0.2,0.1-0.3,0.2-0.5,0.2v0.1v5.2c-0.1,0.2-0.2,0.3-0.2,0.5l-0.1,0.1l-4.5,2.6 c-0.4,0.2-0.6,0.7-0.4,1.1l2.6,4.5c0.2,0.4,0.7,0.6,1.1,0.4l4.5-2.6c0.2-0.1,0.3-0.2,0.5-0.2h0.1l2.6,4.5c0.2,0.4,0.7,0.6,1.1,0.4 l4.5-2.6c0.2-0.1,0.3-0.2,0.5-0.2v-0.1v-5.2c0.1-0.2,0.2-0.3,0.2-0.5l0.1-0.1l4.5-2.6C65,52.2,65.7,51.2,65.5,50.8z M50,56 c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S53.3,56,50,56z" />
                    <path class="icon-accent-fill gear reverse"
                        d="M40.5,80.8l-4.5-2.6l-0.1-0.1c-0.1-0.2-0.2-0.3-0.2-0.5v-5.2c0.1-0.2,0.2-0.3,0.2-0.5l0.1-0.1l4.5-2.6 c0.4-0.2,0.6-0.7,0.4-1.1l-2.6-4.5c-0.2-0.4-0.7-0.6-1.1-0.4l-4.5,2.6c-0.2,0.1-0.3,0.2-0.5,0.2h-0.1l-2.6-4.5 c-0.2-0.4-0.7-0.6-1.1-0.4l-4.5,2.6c-0.2,0.1-0.3,0.2-0.5,0.2v0.1v5.2c-0.1,0.2-0.2,0.3-0.2,0.5l-0.1,0.1l-4.5,2.6 c-0.4,0.2-0.6,0.7-0.4,1.1l2.6,4.5c0.2,0.4,0.7,0.6,1.1,0.4l4.5-2.6c0.2-0.1,0.3-0.2,0.5-0.2h0.1l2.6,4.5c0.2,0.4,0.7,0.6,1.1,0.4 l4.5-2.6c0.2-0.1,0.3-0.2,0.5-0.2v-0.1v-5.2c0.1-0.2,0.2-0.3,0.2-0.5l0.1-0.1l4.5-2.6C40,82.2,40.7,81.2,40.5,80.8z M25,86 c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S28.3,86,25,86z" />
                </svg>
                <div class="element-label">Processing / 数据处理</div>
            </div>

            <!-- Destination Group -->
            <div id="destination-group" class="flow-element">
                <div id="destination-dashboard" class="icon-container">
                    <svg class="icon-svg" viewBox="0 0 100 100">
                        <rect class="icon-bg-fill" x="5" y="5" width="90" height="90" rx="10"></rect>
                        <rect class="icon-fill" x="20" y="60" width="15" height="20"></rect>
                        <rect class="icon-accent-fill" x="42.5" y="40" width="15" height="40"></rect>
                        <rect class="icon-primary-color" x="65" y="20" width="15" height="60"
                            style="fill: var(--primary-color)"></rect>
                    </svg>
                </div>
                <div id="destination-warehouse" class="icon-container">
                    <svg class="icon-svg" viewBox="0 0 100 100">
                        <path class="icon-fill" d="M10 30 L50 10 L90 30 L90 80 L10 80 Z"></path>
                        <rect class="icon-bg-fill" x="25" y="40" width="50" height="40"></rect>
                        <rect class="icon-accent-fill" x="35" y="50" width="30" height="10"></rect>
                    </svg>
                </div>
                <div id="destination-app" class="icon-container">
                    <svg class="icon-svg" viewBox="0 0 100 100">
                        <circle class="icon-bg-fill" cx="50" cy="50" r="45"></circle>
                        <path class="icon-fill" d="M30 30 L70 50 L30 70 Z"></path>
                    </svg>
                </div>
                <div class="element-label">Destinations / 数据目的地</div>
            </div>

            <!-- Flow Path -->
            <svg id="flow-path-svg">
                <path id="flow-path"
                    d="M 300,720 C 550,720 600,450 850,450 C 1100,450 1150,800 1450,800 C 1750,800 1800,650 2100,650">
                </path>
            </svg>

            <div id="summary-overlay">
                <div id="summary-source" class="summary-label">Source</div>
                <div id="summary-process" class="summary-label">Process</div>
                <div id="summary-destination" class="summary-label">Destination</div>
            </div>
        </div>

        <!-- Subtitles -->
        <div id="subtitle-container">
            <span id="subtitle-en" class="subtitle-line"></span>
            <span id="subtitle-cn" class="subtitle-line"></span>
        </div>
    </div>

    <script>
        const titleScene = document.getElementById('title-scene');
        const mainScene = document.getElementById('main-scene');
        const sourceGroup = document.getElementById('source-group');
        const processingGroup = document.getElementById('processing-group');
        const destinationGroup = document.getElementById('destination-group');
        const flowPathSvg = document.getElementById('flow-path-svg');
        const flowPath = document.getElementById('flow-path');
        const subtitleEn = document.getElementById('subtitle-en');
        const subtitleCn = document.getElementById('subtitle-cn');
        const animationContainer = document.getElementById('animation-container');

        const summaryOverlay = document.getElementById('summary-overlay');
        const summaryLabels = document.querySelectorAll('.summary-label');

        const sleep = ms => new Promise(res => setTimeout(res, ms));

        // Subtitle content
        const subtitles = [
            { en: "This is Data Flow.", cn: "这就是数据流。" },
            { en: "It's the journey of data from its origin to its destination.", cn: "它是数据从源头到目的地的旅程。" },
            { en: "It all starts with Data Sources.", cn: "一切都始于数据源。" },
            { en: "Like user activities, mobile apps, or databases.", cn: "例如用户行为、移动应用或数据库。" },
            { en: "Data then travels through a pipeline.", cn: "然后，数据通过一个管道进行传输。" },
            { en: "Along the way, it's often processed.", cn: "在这个过程中，它通常会被处理。" },
            { en: "Cleaning, transforming, or aggregating for analysis.", cn: "为了分析而进行清洗、转换或聚合。" },
            { en: "Finally, the processed data reaches its destination.", cn: "最终，处理后的数据到达其目的地。" },
            { en: "Such as a dashboard, a data warehouse, or another application.", cn: "例如仪表盘、数据仓库或其他应用程序。" },
            { en: "Source, Process, Destination.", cn: "从数据源，到处理，再到目的地。" },
            { en: "This is the core concept of Data Flow.", cn: "这就是数据流的核心概念。" },
            { en: "Understanding Data Flow helps us build better systems.", cn: "理解数据流帮助我们构建更好的系统。" },
        ];

        let currentSubtitle = -1;

        async function updateSubtitle() {
            currentSubtitle++;
            const { en, cn } = subtitles[currentSubtitle];

            subtitleEn.classList.remove('visible');
            subtitleCn.classList.remove('visible');

            await sleep(150);

            subtitleEn.innerText = en;
            subtitleCn.innerText = cn;

            subtitleEn.classList.add('visible');
            subtitleCn.classList.add('visible');
        }

        function getScaledPath() {
            const containerWidth = animationContainer.clientWidth;
            // The path was designed for a 2560px wide viewbox. We scale it.
            const scale = containerWidth / 2560;
            const originalPathD = "M 300,720 C 550,720 600,450 850,450 C 1100,450 1150,800 1450,800 C 1750,800 1800,650 2100,650";

            const scaledPathD = originalPathD.replace(/([0-9.]+)/g, (match) => {
                return (parseFloat(match) * scale).toFixed(2);
            });
            return scaledPathD;
        }

        function createAndAnimateParticle() {
            const particle = document.createElement('div');
            particle.className = 'data-particle';
            mainScene.appendChild(particle);

            const path = document.getElementById('flow-path');
            const pathLength = path.getTotalLength();

            let startTime = null;
            const duration = 8000 + Math.random() * 2000; // 8-10 seconds
            const processingPoint = pathLength * 0.45; // When it passes processing
            const processingEndPoint = pathLength * 0.55;

            function animate(time) {
                if (!startTime) startTime = time;
                const progress = (time - startTime) / duration;

                if (progress >= 1) {
                    particle.remove();
                    return;
                }

                const distance = progress * pathLength;
                const point = path.getPointAtLength(distance);

                particle.style.opacity = '1';
                particle.style.left = `${point.x}px`;
                particle.style.top = `${point.y}px`;

                // Change color after passing processing
                if (distance > processingPoint && distance < processingEndPoint) {
                    const processProgress = (distance - processingPoint) / (processingEndPoint - processingPoint);
                    const r = Math.round(245 + (80 - 245) * processProgress);
                    const g = Math.round(166 + (227 - 166) * processProgress);
                    const b = Math.round(35 + (194 - 35) * processProgress);
                    particle.style.backgroundColor = `rgb(${r},${g},${b})`;
                    particle.style.boxShadow = `0 0 0.8vw rgb(${r},${g},${b})`;
                } else if (distance >= processingEndPoint) {
                    particle.style.backgroundColor = 'var(--secondary-color)';
                    particle.style.boxShadow = '0 0 0.8vw var(--secondary-color)';
                }


                requestAnimationFrame(animate);
            }
            requestAnimationFrame(animate);
        }

        async function playAnimation() {
            // Reset state
            currentSubtitle = -1;
            titleScene.style.opacity = '0';
            mainScene.style.opacity = '0';
            sourceGroup.classList.remove('visible');
            processingGroup.classList.remove('visible');
            destinationGroup.classList.remove('visible');
            flowPathSvg.style.opacity = '0';
            subtitleEn.classList.remove('visible');
            subtitleCn.classList.remove('visible');
            document.querySelectorAll('.data-particle').forEach(p => p.remove());
            summaryOverlay.style.background = 'rgba(255, 255, 255, 0)';
            summaryLabels.forEach(l => {
                l.style.opacity = '0';
                l.style.transform = 'scale(0.7)';
            });

            // Adjust path for current screen size
            flowPath.setAttribute('d', getScaledPath());


            // --- Animation Timeline ---

            await sleep(1000);

            // 1. Title
            titleScene.style.opacity = '1';
            await updateSubtitle(); // "This is Data Flow."
            await sleep(3000);
            await updateSubtitle(); // "It's the journey..."
            await sleep(4000);

            // 2. Transition to Main Scene
            titleScene.style.opacity = '0';
            await sleep(1000);
            mainScene.style.opacity = '1';

            // 3. Show Source
            await updateSubtitle(); // "It all starts with Data Sources."
            sourceGroup.classList.add('visible');
            await sleep(3000);
            await updateSubtitle(); // "Like user activities..."
            await sleep(4000);

            // 4. Start Flow
            await updateSubtitle(); // "Data then travels through a pipeline."
            flowPathSvg.style.opacity = '1';
            let particleInterval = setInterval(createAndAnimateParticle, 400);
            await sleep(4000);

            // 5. Show Processing
            await updateSubtitle(); // "Along the way, it's often processed."
            processingGroup.classList.add('visible');
            await sleep(3000);
            await updateSubtitle(); // "Cleaning, transforming..."
            await sleep(5000);

            // 6. Show Destination
            await updateSubtitle(); // "Finally, the processed data reaches its destination."
            destinationGroup.classList.add('visible');
            await sleep(3000);
            await updateSubtitle(); // "Such as a dashboard..."
            await sleep(5000);

            clearInterval(particleInterval); // Stop creating new particles

            // 7. Summary
            summaryOverlay.style.background = 'rgba(255, 255, 255, 0.6)';
            await updateSubtitle(); // "Source, Process, Destination."
            summaryLabels.forEach(l => {
                l.style.opacity = '1';
                l.style.transform = 'scale(1)';
            });

            await sleep(4000);
            await updateSubtitle(); // "This is the core concept..."
            await sleep(4000);

            // 8. Outro
            await updateSubtitle(); // "Understanding Data Flow..."
            await sleep(5000);

            // 9. Fade out and restart
            mainScene.style.opacity = '0';
            subtitleEn.classList.remove('visible');
            subtitleCn.classList.remove('visible');

            await sleep(2000);
            playAnimation(); // Loop
        }

        window.addEventListener('resize', () => {
            flowPath.setAttribute('d', getScaledPath());
        });

        // Start the animation
        playAnimation();
    </script>

</body>

</html>